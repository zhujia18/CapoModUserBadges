(()=>{var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var r in a)e.o(a,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:a[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};(()=>{"use strict";e.r(t);const a=flarum.core.compat["common/app"];e.n(a)().initializers.add("v17development/flarum-user-badges",(function(){}));const r=flarum.core.compat.extend,s=flarum.core.compat.Model;var n=e.n(s);const o=flarum.core.compat["models/User"];var i=e.n(o);const d=flarum.core.compat["components/UserPage"];var l=e.n(d);const u=flarum.core.compat["utils/UserControls"];var c=e.n(u);const p=flarum.core.compat["components/LinkButton"];var g=e.n(p);const f=flarum.core.compat["components/Button"];var b=e.n(f);function h(e,t){return h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},h(e,t)}function v(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,h(e,t)}const y=flarum.core.compat["utils/mixin"];var B=e.n(y);const N=flarum.core.compat["components/Modal"];var _=e.n(N);const C=flarum.core.compat["helpers/fullTime"];var w=e.n(C);const U=flarum.core.compat["utils/ItemList"];var I=e.n(U);flarum.core.compat["components/Select"];const x=flarum.core.compat["utils/Stream"];var M=e.n(x),O=function(e){function t(){return e.apply(this,arguments)||this}v(t,e);var a=t.prototype;return a.oninit=function(t){var a=this;e.prototype.oninit.call(this,t),this.selectedBadge=this.attrs.badge?this.attrs.badge.badge():null,this.user=this.attrs.badge?this.attrs.badge.user():this.attrs.user,this.userHasBadge=!1,this.badge=this.attrs.badge?this.attrs.badge:app.store.createRecord("userBadges"),this.description=M()(this.badge.description()),this.categories={},this.uncategorizedBadges=[],this.loading=!1,this.attrs.badge||(this.loading=!0,app.store.find("badges",{include:"category"}).then((function(e){e.forEach((function(e){if(e.category()){var t=e.category();a.categories[t.id()]?a.categories[t.id()].badges.push(e):a.categories[t.id()]={category:t,badges:[e]}}else a.uncategorizedBadges.push(e)})),a.loading=!1,m.redraw()})))},a.className=function(){return"Modal--small BadgeModal"},a.title=function(){return app.translator.trans("v17development-flarum-badges.forum."+(this.badge.exists?"update":"give")+"_badge")},a.content=function(){return m("div",null,m("div",{className:"Modal-body"},m("div",{className:"Form"},this.fields().toArray())),m("div",{className:"Modal-footer"},m(b(),{className:"Button Button--primary",type:"submit",loading:this.loading,disabled:this.userHasBadge},app.translator.trans("core.forum.composer_edit.submit_button"))))},a.fields=function(){var e=this,t=new(I());return t.add("badge",m("div",{className:"BadgeModalListItem"},m("p",null,m("b",null,app.translator.trans("v17development-flarum-badges.forum.badge.badge"))),m("div",{className:"Select"},m("select",{value:this.selectedBadge?this.selectedBadge.id():"empty",disabled:!!this.attrs.badge,onchange:function(t){"empty"!==t.target.value&&(e.selectedBadge=app.store.getById("badges",t.target.value),e.checkUserHasBadge(e.selectedBadge))},className:"Select-input FormControl"},m("option",{value:"empty"},app.translator.trans("v17development-flarum-badges.forum.select_badge")),!this.attrs.badge&&Object.values(this.categories).map((function(e){var t=e.category,a=e.badges;return m("optgroup",{label:t.name()},a.map((function(e){return m("option",{value:e.id()},e.name())})))})),!this.attrs.badge&&this.uncategorizedBadges.length>=1&&m("optgroup",{label:app.translator.trans("v17development-flarum-badges.forum.uncategorized")},this.uncategorizedBadges.map((function(e){return m("option",{value:e.id()},e.name())}))),!!this.attrs.badge&&m("option",{value:this.selectedBadge.id()},this.selectedBadge.name())),m("i",{class:"icon fas fa-caret-down Select-caret"})),this.userHasBadge&&m("p",{className:"UserHasBadge"},app.translator.trans("v17development-flarum-badges.forum.user_has_badge"))),30),t.add("badge_description",m("div",{className:"BadgeModalListItem"},m("p",null,m("b",null,app.translator.trans("v17development-flarum-badges.forum.badge.description"),":")),m("p",null,this.selectedBadge?this.selectedBadge.description():app.translator.trans("v17development-flarum-badges.forum.select_badge"))),30),t.add("description",m("div",{className:"BadgeModalListItem"},m("p",null,m("b",null,app.translator.trans("v17development-flarum-badges.forum.badge.earning_reason"))),m("textarea",{className:"FormControl",placeholder:app.translator.trans("v17development-flarum-badges.forum.badge.earning_reason"),bidi:this.description})),30),t},a.checkUserHasBadge=function(e){var t=!1;this.user.userBadges().map((function(a){a.badge()==e&&(t=!0)})),this.userHasBadge=t,m.redraw()},a.onsubmit=function(e){var t=this;e.preventDefault(),this.loading=!0,this.badge.save({description:this.description(),relationships:this.attrs.badge?{}:{badge:this.selectedBadge,user:this.user}}).then((function(){t.attrs.badge?app.modal.show(k,{badge:t.attrs.badge.badge(),userBadgeData:t.attrs.badge}):t.hide(),m.redraw()}),(function(e){t.loading=!1,t.handleErrors(e)}))},t}(_()),k=function(e){function t(){return e.apply(this,arguments)||this}v(t,e);var a=t.prototype;return a.oninit=function(t){e.prototype.oninit.call(this,t),this.loading=!1},a.className=function(){return"Modal--small"},a.title=function(){return app.translator.trans("v17development-flarum-badges.forum.badge_information")},a.content=function(){var e=this;return m("div",null,m("div",{className:"Modal-body"},this.data().toArray()),m("div",{className:"Modal-footer"},m(g(),{href:app.route("badges.item",{id:this.attrs.badge.id()}),className:"Button",style:{margin:"0 10px"}},app.translator.trans("v17development-flarum-badges.forum.badge.badge_details")),this.attrs.userBadgeData&&app.forum.attribute("canGiveBadge")&&m(b(),{className:"Button Button--primary",onclick:function(){confirm(app.translator.trans("v17development-flarum-badges.forum.moderation.remove_badge_confirm"))&&(e.loading=!0,e.attrs.userBadgeData.delete().then((function(){return e.hide()})))},loading:this.loading},app.translator.trans("v17development-flarum-badges.forum.moderation.remove_badge"))))},a.data=function(){var e=this,t=new(I());return t.add("name",m("div",{className:"BadgeModalListItem"},m("p",null,m("b",null,app.translator.trans("v17development-flarum-badges.forum.badge.name"),":")),m("p",null,this.attrs.badge.name()))),t.add("description",m("div",{className:"BadgeModalListItem"},m("p",null,m("b",null,app.translator.trans("v17development-flarum-badges.forum.badge.description"),":")),m("p",null,this.attrs.badge.description()))),this.attrs.userBadgeData&&(this.attrs.userBadgeData.description()||app.forum.attribute("canGiveBadge"))&&t.add("earning_reason",m("div",{className:"BadgeModalListItem"},m("p",null,m("b",null,app.translator.trans("v17development-flarum-badges.forum.badge.earning_reason"),":")),m("p",null,this.attrs.userBadgeData.description()?this.attrs.userBadgeData.description():m("i",null,app.translator.trans("v17development-flarum-badges.forum.badge.no_earning_reason"))),m("p",null,app.forum.attribute("canGiveBadge")&&m("a",{href:"#",onclick:function(t){t.preventDefault(),app.modal.show(O,{badge:e.attrs.userBadgeData})}},app.translator.trans("v17development-flarum-badges.forum.badge.update_earning_reason"))))),this.attrs.userBadgeData&&t.add("earned_date",m("div",{className:"BadgeModalListItem"},m("p",null,m("b",null,app.translator.trans("v17development-flarum-badges.forum.badge.earned_on"),":")),m("p",null,w()(this.attrs.userBadgeData.assignedAt())))),this.attrs.userBadgeData&&t.add("category",m("div",{className:"BadgeModalListItem"},m("p",null,m("b",null,app.translator.trans("v17development-flarum-badges.forum.badge.category"),":")),m("p",null,this.attrs.badge.category()&&this.attrs.badge.category().name(),!this.attrs.badge.category()&&app.translator.trans("v17development-flarum-badges.forum.uncategorized")))),this.attrs.badge&&this.attrs.badge.earnedAmount()&&t.add("earned_amount",m("div",{className:"BadgeModalListItem"},m("p",null,app.translator.trans("v17development-flarum-badges.forum.badge.earned_count",{count:this.attrs.badge.earnedAmount()})))),t},t}(_()),L=function(e){function t(){return e.apply(this,arguments)||this}return v(t,e),t.prototype.apiEndpoint=function(){return"/badges"+(this.exists?"/"+this.data.id:"")},t}(B()(n(),{name:n().attribute("name"),icon:n().attribute("icon"),order:n().attribute("order"),image:n().attribute("image"),description:n().attribute("description"),isVisible:n().attribute("isVisible"),createdAt:n().attribute("createdAt"),earnedAmount:n().attribute("earnedAmount"),category:n().hasOne("category"),backgroundColor:n().attribute("backgroundColor"),iconColor:n().attribute("iconColor"),labelColor:n().attribute("labelColor")})),P=function(e){function t(){return e.apply(this,arguments)||this}return v(t,e),t.prototype.apiEndpoint=function(){return"/badge_categories"+(this.exists?"/"+this.data.id:"")},t}(B()(n(),{name:n().attribute("name"),order:n().attribute("order"),description:n().attribute("description"),isEnabled:n().attribute("isEnabled"),createdAt:n().attribute("createdAt"),isTable:n().attribute("isTable"),users:n().hasMany("users"),badges:n().hasMany("badges")})),A=function(e){function t(){return e.apply(this,arguments)||this}return v(t,e),t.prototype.apiEndpoint=function(){return"/user_badges"+(this.exists?"/"+this.data.id:"")},t}(B()(n(),{user:n().hasOne("user"),badge:n().hasOne("badge"),description:n().attribute("description"),isPrimary:n().attribute("isPrimary"),assignedAt:n().attribute("assignedAt"),inUserCard:n().attribute("inUserCard")}));const D=flarum.core.compat["components/LoadingIndicator"];var T=e.n(D);const S=flarum.core.compat["common/Component"];var z=e.n(S);const j=flarum.core.compat["common/components/Tooltip"];var E=e.n(j),V=function(e){function t(){return e.apply(this,arguments)||this}v(t,e);var a=t.prototype;return a.oninit=function(t){e.prototype.oninit.call(this,t),this.tooltip=!1!==this.attrs.tooltip,this.forceVisibility=!0===this.attrs.forceVisibility},a.view=function(){return this.attrs.badge.isVisible()||this.forceVisibility?!1===this.tooltip?this.badge():m(E(),{text:""+(this.attrs.badge.description()?this.attrs.badge.description():"")},this.badge()):null},a.badge=function(){var e=this,t=!this.attrs.badge.isVisible()&&this.forceVisibility;return this.attrs.badge.image()?m("img",{src:this.attrs.badge.image(),className:"UserBadgeImage",onclick:function(){e.attrs.onclick&&e.attrs.onclick()},style:{opacity:t?.5:void 0}}):m("span",{className:"UserBadge UserBadge-"+this.attrs.badge.id(),onclick:function(){e.attrs.onclick&&e.attrs.onclick()},style:{backgroundColor:this.attrs.badge.backgroundColor(),color:this.attrs.badge.labelColor(),borderColor:this.attrs.badge.backgroundColor(),opacity:t?.5:void 0}},m("i",{className:this.attrs.badge.icon(),style:{color:this.attrs.badge.iconColor()}})," ",this.attrs.badge.name())},t}(z());function H(e){var t={},a=[];e.userBadges().map((function(e){if(!e)return null;if(e.badge().category()){var r=e.badge().category();t[r.id()]?t[r.id()].badges.push(e):t[r.id()]={name:r.name(),category:r,badges:[e]}}else a.push(e)}));var r=Object.keys(t).sort((function(e,a){return t[e].category.order()-t[a].category.order()})).map((function(e){return t[e]}));return a.length>=1&&r.push({name:app.translator.trans("v17development-flarum-badges.forum.uncategorized"),category:null,badges:a}),r}var G=function(e){function t(){return e.apply(this,arguments)||this}return v(t,e),t.prototype.view=function(){var e=H(this.attrs.user);return m("div",{className:"UserBadges"},0===e.length&&m("div",{className:"Placeholder"},m("p",null,app.translator.trans("v17development-flarum-badges.forum.user_no_badges"))),e.length>=1&&e.map((function(e){var t=e.name,a=e.category,r=e.badges;return a&&!a.isEnabled()?null:m("div",{className:"UserBadgesCategory"},m("h3",null,t),a&&a.description()&&m("p",null,a.description()),r.sort((function(e,t){return e.badge().order()-t.badge().order()})).map((function(e){return m(V,{badge:e.badge(),onclick:function(){return app.modal.show(k,{badge:e.badge(),userBadgeData:e})}})})))})))},t}(z()),R=function(e){function t(){return e.apply(this,arguments)||this}v(t,e);var a=t.prototype;return a.oninit=function(t){e.prototype.oninit.call(this,t),this.user=null,this.loading=!0,this.loadUser(m.route.param("username"))},a.content=function(){return!this.user||this.loading?m(T(),{size:46}):G.component({user:this.user})},a.show=function(t){var a=this;e.prototype.show.call(this,t),this.user=t,app.store.find("users",t.id(),{include:"userBadges,userBadges.badge,userBadges.badge.category"}).then((function(){a.loading=!1,m.redraw()}))},t}(l());const F=flarum.core.compat["components/Page"];var q=e.n(F);const J=flarum.core.compat["components/IndexPage"];var K=e.n(J);const Q=flarum.core.compat["common/helpers/listItems"];var W=e.n(Q);const X=flarum.core.compat["components/Link"];var Y=e.n(X),Z=function(e){function t(){return e.apply(this,arguments)||this}return v(t,e),t.prototype.view=function(){if(!this.attrs.badges)return null;var e=this.attrs.badges;return m("table",{width:"100%",className:"BadgeTable"},m("thead",null,m("tr",null,m("th",{scope:"col"},app.translator.trans("v17development-flarum-badges.forum.badge.badges")),m("th",{scope:"col"},app.translator.trans("v17development-flarum-badges.forum.badge.description")))),m("tbody",null,e.map((function(e){return m("tr",null,m("td",null,m(Y(),{href:app.route("badges.item",{id:e.id()})},m(V,{badge:e,tooltip:!1}))),m("td",null,e.description(),m("div",{className:"BadgeTableRewarded"},app.translator.trans("v17development-flarum-badges.forum.badge.earned_count",{count:e.earnedAmount()}))))}))))},t}(z()),$=function(e){function t(){return e.apply(this,arguments)||this}return v(t,e),t.prototype.view=function(){if(!this.attrs.badges)return null;var e=this.attrs.badges;return m("ul",{className:"BadgeCategoryList"},e.map((function(e){return m("li",null,m(Y(),{href:app.route("badges.item",{id:e.id()}),className:"BadgeContainer"},m("div",{className:"BadgeContainerInfo"},m(V,{badge:e,tooltip:!1}),m("p",{className:"BadgeDescription"},e.description()),m("p",null,app.translator.trans("v17development-flarum-badges.forum.badge.earned_count",{count:e.earnedAmount()})))))})))},t}(z()),ee=function(e){function t(){return e.apply(this,arguments)||this}v(t,e);var a=t.prototype;return a.oninit=function(t){var a=this;e.prototype.oninit.call(this,t),this.bodyClass="App--index",this.loading=!0,app.history.push("badgeOverviewPage"),app.setTitle(app.translator.trans("v17development-flarum-badges.forum.badge.badges")),app.store.find("badge_categories").then((function(){a.loading=!1,m.redraw()}))},a.view=function(){var e=app.store.all("badgeCategories").sort((function(e,t){return e.order()-t.order()}));return m("div",{className:"IndexPage"},K().prototype.hero(),m("div",{className:"container"},m("div",{className:"sideNavContainer"},m("nav",{className:"IndexPage-nav sideNav"},m("ul",null,W()(K().prototype.sidebarItems().toArray()))),m("div",{className:"IndexPage-results sideNavOffset"},m("h2",{className:"BadgeOverviewTitle"},app.translator.trans("v17development-flarum-badges.forum.badge.badges")),this.loading&&m(T(),{size:"large"}),!this.loading&&e.map((function(e){var t=e.badges().sort((function(e,t){return e.order()-t.order()}));return m("div",{className:"BadgeCategory"},m("h3",null,e.name()),e.description()&&m("p",null,e.description()),e.isTable()&&m(Z,{badges:t}),!e.isTable()&&m($,{badges:t}))}))))))},t}(q());const te=flarum.core.compat["helpers/avatar"];var ae=e.n(te);const re=flarum.core.compat["helpers/humanTime"];var se=e.n(re),ne=function(e){function t(){return e.apply(this,arguments)||this}v(t,e);var a=t.prototype;return a.oninit=function(t){e.prototype.oninit.call(this,t),this.attrs.state.refreshParams({filter:{badge:this.attrs.badgeId},sort:"-assignedAt"})},a.view=function(){var e=this.attrs.state,t=null;return e.isInitialLoading()||e.isLoadingNext()?t=T().component({size:"large"}):e.hasNext()&&(t=b().component({className:"Button",icon:"fas fa-chevron-down",onclick:e.loadNext.bind(e)},app.translator.trans("core.forum.discussion_list.load_more_button"))),e.isInitialLoading()&&e.isEmpty()?m(T(),null):e.isEmpty()?m("div",{className:"BadgeUserList-empty"},app.translator.trans("v17development-flarum-badges.forum.no_received")):m("div",null,m("ul",{className:"BadgeUserList"},e.getPages().map((function(e){return e.items.map((function(e){return m("li",null,m(Y(),{href:app.route("user.badges",{username:e.user().username()}),className:"BadgeUserList-user"},ae()(e.user()),m("div",{className:"BadgeUserList-userinfo"},m("h4",null,e.user().displayName()),m("p",null,app.translator.trans("v17development-flarum-badges.forum.badge.received_on",{date:se()(e.assignedAt())})))))}))}))),t&&m("div",{className:"SupportSearchList-loadMore"},t))},t}(z()),oe=function(e){function t(){return e.apply(this,arguments)||this}v(t,e);var a=t.prototype;return a.oninit=function(t){var a=this;e.prototype.oninit.call(this,t),this.bodyClass="App--index";var r=app.store.getById("badges",m.route.param("id"));this.loading=!r,r?(app.history.push("badgeItemPage",r.name()),this.setTitle(r)):app.store.find("badges/"+m.route.param("id")).then((function(e){a.loading=!1,app.history.push("badgeItemPage",e.name()),a.setTitle(e),m.redraw()}))},a.setTitle=function(e){app.setTitle(e.name()+" - "+app.translator.trans("v17development-flarum-badges.forum.badge.badges"))},a.view=function(){var e=app.store.getById("badges",m.route.param("id"));return m("div",{className:"IndexPage"},K().prototype.hero(),m("div",{className:"container"},m("div",{className:"sideNavContainer"},m("nav",{className:"IndexPage-nav sideNav"},m("ul",null,W()(K().prototype.sidebarItems().toArray()))),m("div",{className:"IndexPage-results sideNavOffset"},m(g(),{href:app.route("badges"),icon:"fas fa-chevron-left",className:"Button BadgesOverviewButton"},app.translator.trans("v17development-flarum-badges.forum.badge.badges")),this.loading&&m(T(),{size:"large"}),!this.loading&&m("div",{className:"BadgeUserListInfo"},m("i",{className:e.icon()}),m("div",{className:"BadgeUserListInfo-meta"},m("h3",null,e.name()),m("p",null,e.description()))),e&&m("h3",null,app.translator.trans("v17development-flarum-badges.forum.badge.earned_by_count",{count:e.earnedAmount()})),!this.loading&&app.forum.attribute("canViewDetailedBadgeUsers")&&m(ne,{state:app.userBadgeListState,badgeId:e.id()})))))},t}(q());function ie(){(0,r.extend)(K().prototype,"navItems",(function(e){return e.add("badges",m(g(),{icon:"fas fa-id-badge",href:app.route("badges")},app.translator.trans("v17development-flarum-badges.forum.badge.badges")),15),e}))}function de(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}const le=flarum.core.compat["common/states/PaginatedListState"];var ue=function(e){function t(t,a){return void 0===a&&(a=1),e.call(this,t,a,18)||this}var a,r;return v(t,e),a=t,(r=[{key:"type",get:function(){return"user_badges"}}])&&de(a.prototype,r),t}(e.n(le)());const me=flarum.core.compat["forum/components/Notification"];var ce=function(e){function t(){return e.apply(this,arguments)||this}v(t,e);var a=t.prototype;return a.icon=function(){return""},a.href=function(){return app.route("user.badges",{username:app.session.user.username()})},a.content=function(){return app.translator.trans("v17development-flarum-badges.forum.notification.title")},a.excerpt=function(){var e=this.attrs.notification.subject();return m("div",null,m("i",{className:"icon "+e.badge().icon()}),e.badge().name())},t}(e.n(me)());const pe=flarum.core.compat["forum/components/NotificationGrid"];var ge=e.n(pe);const fe=flarum.core.compat["forum/app"];var be=e.n(fe);const he=flarum.core.compat["common/extend"],ve=flarum.core.compat["forum/components/UserCard"];var ye=e.n(ve);const Be=flarum.core.compat["common/components/Link"];var Ne=e.n(Be);const _e=flarum.core.compat["components/Switch"];var Ce=e.n(_e),we=function(e){function t(){return e.apply(this,arguments)||this}v(t,e);var a=t.prototype;return a.oninit=function(t){e.prototype.oninit.call(this,t),this.loading=!1,this.limit=app.forum.attribute("numberOfBadgesOnUserCard"),this.selectedBadges=this.attrs.user.userBadges().filter((function(e){return e.inUserCard()})).map((function(e){return e.id()}))},a.className=function(){return"Modal--big UserCardBadgesModal"},a.title=function(){return app.translator.trans("v17development-flarum-badges.forum.badges_in_card.title")},a.content=function(){var e=this;return m("div",null,m("div",{className:"Modal-body"},this.data().toArray()),m("div",{className:"Modal-footer"},m(b(),{className:"Button Button--primary",onclick:function(){return e.save()},loading:this.loading},app.translator.trans("v17development-flarum-badges.forum.save_changes"))))},a.data=function(){var e=this,t=new(I()),a=H(this.attrs.user);return t.add("info",m("div",{className:"BadgeModalListItem"},m("p",null,app.translator.trans("v17development-flarum-badges.forum.badges_in_card.description")),m("p",null,app.translator.trans("v17development-flarum-badges.forum.badges_in_card.select_limit",{limit:app.forum.attribute("numberOfBadgesOnUserCard")})))),a.map((function(a){var r=a.name,s=a.category,n=a.badges;t.add("badge_category_"+(s?s.id():"uncategorized"),m("div",{className:"UserCardBadgesModalCategory"},m("div",{className:"UserCardBadgesModalCategory-name"},r),n.sort((function(e,t){return e.badge().order()-t.badge().order()})).map((function(t){var a=e.selectedBadges.length>=e.limit&&-1===e.selectedBadges.indexOf(t.id());return m(E(),{text:a?app.translator.trans("v17development-flarum-badges.forum.badges_in_card.hit_limit",{limit:app.forum.attribute("numberOfBadgesOnUserCard")}):"",position:"bottom"},m("div",{className:"UserCardBadgesModalCategory-badge",onclick:function(){if(!a){var r=e.selectedBadges.indexOf(t.id());r>=0?e.selectedBadges.splice(r,1):e.selectedBadges.push(t.id())}}},m("div",{className:"UserCardBadgesModalCategory-badge-preview"},m(V,{badge:t.badge(),onclick:function(){}})),m("div",{className:"UserCardBadgesModalCategory-badge-switch"},Ce().component({state:e.selectedBadges.indexOf(t.id())>=0,disabled:a}))))}))))})),t},a.save=function(){var e=this;this.loading=!0,this.attrs.user.save({userCardBadges:this.selectedBadges}).then((function(){e.attrs.user.userBadges().map((function(t){t.pushAttributes({inUserCard:e.selectedBadges.indexOf(t.id())>=0})})),e.hide()})).catch((function(){})).then((function(){e.loading=!1,m.redraw()}))},t}(_());const Ue=flarum.core.compat["forum/states/DiscussionListState"];var Ie=e.n(Ue);app.initializers.add("v17development-flarum-badges",(function(e){e.store.models.badges=L,e.store.models.badgeCategories=P,e.store.models.userBadges=A,i().prototype.userBadges=n().hasMany("userBadges"),i().prototype.userPrimaryBadge=n().hasOne("userPrimaryBadge"),e.routes["user.badges"]={path:"/u/:username/badges",component:R},e.routes.badges={path:"/badges",component:ee},e.routes["badges.item"]={path:"/badges/:id",component:oe},ie(),e.userBadgeListState=new ue({}),e.notificationComponents.badgeReceived=ce,(0,r.extend)(ge().prototype,"notificationTypes",(function(t){t.add("badgeReceived",{name:"badgeReceived",icon:"fas fa-user-tag",label:e.translator.trans("v17development-flarum-badges.forum.notification.settings")})})),(0,r.extend)(l().prototype,"navItems",(function(t){t.add("badges",g().component({href:e.route("user.badges",{username:this.user.username()}),name:"badges",icon:"fas fa-user-tag"},[e.translator.trans("v17development-flarum-badges.forum.badge.badges"),m("span",{className:"Button-badge"},this.user.userBadges().length)]),90)})),(0,r.extend)(c(),"moderationControls",(function(t,a){e.forum.attribute("canGiveBadge")&&t.add("test",m(b(),{icon:"fas fa-user-tag",onclick:function(){return e.modal.show(O,{user:a})}},e.translator.trans("v17development-flarum-badges.forum.give_badge")))})),(0,he.extend)(ye().prototype,"infoItems",(function(e){var t,a=this.attrs.user;if(be().forum.attribute("showBadgesOnUserCard")&&a.userBadges){var r=null!=(t=a.userBadges())?t:[];if(!(r.length<1)&&r){var s=be().forum.attribute("numberOfBadgesOnUserCard"),n=r.filter((function(e){return e.inUserCard()}));0===n.length&&(n=r.slice(0,s));var o=n.map((function(e){return m(V,{badge:e.badge(),onclick:function(){return be().modal.show(k,{badge:e.badge(),userBadgeData:e})}})}));if(o.length<r.length){var i=r.length-n.length;o.push(m(Ne(),{href:be().route("user.badges",{username:a.username()}),className:"UserBadge more-badges"},be().translator.trans("v17development-flarum-badges.forum.badge.others_link",{count:i})))}(a===be().session.user&&be().forum.attribute("editOwnUserCardBadges")||be().forum.attribute("editUserCardBadges"))&&o.push(m(E(),{text:be().translator.trans("v17development-flarum-badges.forum.badges_in_card.manage_badges")},m("a",{href:"#",className:"UserBadge more-badges",onclick:function(e){e.preventDefault(),be().modal.show(we,{user:a})}},m("i",{className:"fas fa-pencil-alt BadgeIconOnly"})))),e.add("badges",o)}}})),(0,r.extend)(Ie().prototype,"requestParams",(function(e){var t;"string"==typeof e.include?e.include=[e.include]:null==(t=e.include)||t.push("user.userBadges","user.userBadges.badge")}))}))})(),module.exports=t})();
//# sourceMappingURL=forum.js.map